"use strict";var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var r,e=1,n=arguments.length;e<n;e++)for(var o in r=arguments[e])Object.prototype.hasOwnProperty.call(r,o)&&(t[o]=r[o]);return t}).apply(this,arguments)},__rest=this&&this.__rest||function(t,r){var e={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&r.indexOf(n)<0&&(e[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(t);o<n.length;o++)r.indexOf(n[o])<0&&(e[n[o]]=t[n[o]])}return e},__importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0});var query_string_1=__importDefault(require("query-string")),XmlFetch=function(){function e(t){void 0===t&&(t={});var r=this;this._xhr=new XMLHttpRequest,this._pending=!1,this._callbackResponce=[],this._callbackError=[],this._options=__assign({},e.options,t),this._xhr.onload=this._handlerLoad(this),this._xhr.timeout=this._options.timeout,this._xhr.ontimeout=function(){return r._handlerError(new Error(r._options.timeoutError))}}return Object.defineProperty(e.prototype,"options",{get:function(){return __assign({},this._options)},set:function(t){this._options=__assign({},this._options,t)},enumerable:!0,configurable:!0}),e.prototype._getDataBody=function(e,t){var r;return Array.isArray(t)?t.map(function(t){var r;return query_string_1.default.stringify(((r={})[e]=t,r))}).join("&"):query_string_1.default.stringify(((r={})[e]=t,r))},e.prototype._handlerLoad=function(e){var n={};return function(){if((this.status<400||500<=this.status)&&200!==this.status)e._handlerError(new Error(this.status+" "+this.statusText));else if((n=JSON.parse(this.responseText)).errors){if("object"==typeof n.errors){var t=Object.keys(n.errors);if(t.length){var r={};t.forEach(function(t){return r[t]=n.errors[t].msg}),n=r}}e._handlerError(new Error(n.errors))}else e._handlerSuccess(n)}},e.prototype._handlerError=function(t){this._pending=!1,this._callbackError.reduce(function(t,r){return Array.isArray(t)?r(t.slice()):r("object"==typeof t?__assign({},t):t)},t)},e.prototype._handlerSuccess=function(t){this._pending=!1,this._callbackResponce.reduce(function(t,r){return Array.isArray(t)?r(t.slice()):r("object"==typeof t?__assign({},t):t)},t)},e.prototype._setHeaders=function(){var t=this._options.headers;for(var r in t)this._xhr.setRequestHeader(r,t[r])},e.prototype._request=function(t,r){var e=r.query,n=void 0===e?{}:e,o=__rest(r,["query"]);if(!this._pending){var s=n?"?"+query_string_1.default.stringify(n):"";this._pending=!0,this._xhr.open(this._options.method,""+t+s,this._options.async),this._setHeaders(),this._xhr.send(o.body)}},e.prototype.get=function(t,r,e){var n=__rest(r,[]);return this.options=__assign({method:"GET"},e),this._request(t,n),this},e.prototype.post=function(t,r,e){var n=this,o=__rest(r,[]),s=o.files,i=o.data,a={body:""};if(this.options=__assign({method:"POST"},e),s){var u=new FormData,h=function(r){s[r].forEach(function(t){return u.append(r,t)})};for(var p in s)h(p);if(i)for(var p in i)u.append(p,i[p]);a.body=u}else i&&(this._options.headers["Content-Type"]||(this._options.headers["Content-Type"]="application/x-www-form-urlencoded; charset=UTF-8"),a.body="string"==typeof i?i:Object.keys(i).map(function(t){return n._getDataBody(t,i[t])}).join("&"));return this._request(t,a),this},e.prototype.put=function(t,r,e){var n=__rest(r,[]);return this.post(t,n,__assign({method:"PUT"},e))},e.prototype.del=function(t,r,e){var n=__rest(r,[]);return this.get(t,n,__assign({method:"DELETE"},e))},e.prototype.then=function(t){return this._callbackResponce.push(t),this},e.prototype.catch=function(t){return this._callbackError.push(t),this},e.prototype.abort=function(){return this._xhr.abort(),this},e.options={method:"GET",async:!0,headers:{},timeout:3e4,timeoutError:"Извините, запрос превысил максимальное время ожидания"},e}(),http={get:function(t,r,e){return(new XmlFetch).get(t,r,e)},post:function(t,r,e){return(new XmlFetch).post(t,r,e)},put:function(t,r,e){return(new XmlFetch).put(t,r,e)},del:function(t,r,e){return(new XmlFetch).del(t,r,e)}};exports.http=http,exports.default=XmlFetch;